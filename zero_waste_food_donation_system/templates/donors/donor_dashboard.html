<!DOCTYPE html>
<html>
<head>
    <title>Donor Dashboard</title>
<script>
    function showNotification(message) {
        alert(message); // Simple alert for now; replace with a custom popup or WebSocket
    }
    // Polling to check for new requests (simplified)
    setInterval(() => {
        fetch(`/check_requests/{{ request.session.donor_id }}/`)
            .then(response => response.json())
            .then(data => {
                if (data.message) showNotification(data.message);
            });
    }, 5000); // Check every 5 seconds
</script>

</head>
<body>
    <h1>Donor Dashboard</h1>
    {% if request.session.donor_id %}
        <p>Welcome, Donor ID: {{ request.session.donor_id }}</p>
        <h2>Your Donations</h2>
        <ul>
        {% for donation in donations %}
            <li>
                {{ donation.food_type }} - {{ donation.quantity }} {{ donation.unit }} - 
                Status: {{ donation.status }} - Expires: {{ donation.expiry_time }}
            </li>
        {% endfor %}
        </ul>
        <h2>Pending Pickups</h2>
        <ul>
        {% for pickup in scheduled_pickups %}
            <li>
                {{ pickup.donation_id.food_type }} - Receiver: {{ pickup.receiver_id.name }} - 
                Status: {{ pickup.pickup_status }} - Scheduled: {{ pickup.scheduled_time }}
                {% if pickup.pickup_status == 'pending' %}
                    <form method="post" style="display:inline;">
                        {% csrf_token %}
                        <input type="hidden" name="pickup_id" value="{{ pickup.schedule_id }}">
                        <button type="submit" name="action" value="accept">Accept</button>
                        <button type="submit" name="action" value="reject">Reject</button>
                    </form>
                {% endif %}
            </li>
        {% endfor %}
        </ul>
        <p><a href="{% url 'donors:donation_entry' %}">Add New Donation</a></p>
        <p><a href="{% url 'donors:donor_logout' %}">Logout</a></p>
    {% else %}
        <p>Not logged in.</p>
    {% endif %}
</body>
</html>